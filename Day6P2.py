puzzle_input = """.....#..#................#...###..............................#..#.......................................#........................
..................#...........#.............#.#.#.#......................#.......##.........................................#.##.#
....#.......................................................#.......#.........................#...................................
.#.............#...........#..........................#.....................................................................#.....
....#..#................#..........................#..#..#...#..........#....................................#.#..................
...........................#....#.##......................................................................##...................#..
...........................#.....................................#....##.#..#..#.....#................#...........................
.....#..............#........#........................................###...........#..................................#..........
........#..............#............................................................#..............................#..............
......#..............................#..........................#................................................#................
................#..#......................#.......................................................................................
..#.............................##.....#.......................................................#..................................
#.......................................#...#.............................#...........#.#.........#.............#.................
..............................#................................#...#................................................#.............
..............#...............#.................#........................#...#.....#................#.............................
...................................#...#...........#...............#.........#............#...............##...........#.#........
.........................#..................................................................#.........#...........................
.##.............#................................#.......#.........#..............................................#...............
....#.................#.....#.......................................................#......................#......................
#..................................#................#......#.........................#............................................
.....#..................#................#........................................................................................
......#......#.......#......#.#....................#..................................#...................#...#...............#.#.
.................................................#......#......#.........#..................#.....................................
...........#.....#..................................#...#........#......#...#..................#.##....#.................#.......#
........#..#....................................#...................................................................#.......#.....
...........#..............#.............................................#..............#.#........#..##.................#.......#.
......................................#............................................#...#..........................................
.......#.............#............................#.........#................#.......................................#............
..........................................................................#.............#...............................#.........
......##...............#..........................................................................................#...............
.........#..#................................................#..................................#.......#.....................#...
...#..............................#.#.............#........................#..............#..............................#........
.......................................................................................................#.............#............
.....#.......................#..#..........#.....................................................................................#
..........##..........................#...............................#.......................#...............#.............#..#..
..#....#....................#.............#......#.............................................................#..................
.#....#..........................................................................................#.#......#.....................#.
..........................#.......#......................................................#........................................
.#......#.#......................................................................#........#.........#.........#.#.................
.....................................#........#..........#.............................#..#............#....................#.....
............#.........#.........................................................................................#........##.......
....................#.................#.........................#......................#......................................#...
............#....................................................#..#.........#..........#...................................#....
#.....#...................#.........#.#..................................................................................#........
.............................##.......#........................................#..........#..............#..#.....................
.............#....................................^.##....................................................#.....................#.
........................#.#..#......................#............#...#..........................#.......................#.........
......................#.......................................................................#.#..#......................#.......
..................................................#.......##...................................#..................................
.............................#..........................................#..............#.#.............................#..........
....#.............#..................#.....#..........................#....#..........#.........#........................#.......#
...............#...........................#...............#....................................................................#.
..........................#.............#..........................................................#..............................
...............#...................................#.......................#.............................#...............#........
....#......................##......#.#................................................#................#.............#............
.......#...................#..........................................#.....................................#.....................
.#.....................#..........................................................................................................
........#.#...........#....#...................................#..#.#....#..................#.#...............#......#........#...
#....#............#...#.........#...........#......................#.....................#........................................
........................#.............#.................................................................#.....#...................
...............#....................#................##...#...........#.#..............#..........................................
........................#...........##.......#.....#...........................#..#...................................#...........
.............#........................................................................#.....#.#.#.................##..............
......#......................#.........#..............#...............#................#..................#........#..............
..........#..........................................................................................................#............
..................#...........#................#..#.#..............#.#........#...............................#....#..........##..
...........#..............#...................................................#...................................................
..................................................................#............#............................#.................#...
....#...........#...................#..........................................#..........#...........................#...........
........................................#....................#....#..#........................#.....#.............................
................#........................................................................................................#........
...................#......#.....#..............#..................................#...#.............#........................#....
...................#............................................................#.............#...................................
.......#........................#..........#.............#....#....#.............#.............................#...#..............
...#...............##.............................................................#.................#........................#....
.............................#.................#..................#.#....................#.....................................###
...............#....#.....................................................#..............................................#.......#
....................................#..................................#.......................#..................................
#..#............#................................#....#...............#.........#...........................#.....................
...........................................................................................................#.............#....#..#
...................................#....#.........#..................#......#....................#..........#.....................
...........#.............................................................##.#......#.....#......................#...#.............
..#...................................................................................#.................#.........#...............
.......#..#..#.................................#.....................#..............................................#....#........
..........................#....................................................................................................#..
..#.............#......#..................................#..#.......................#..........#...#...##......#.................
....#...................#....#.........................................................#..................................#.......
.................................#...............#.....................#..#.......................................................
...........#......................................................................................................#...........#...
.............#.................................................................#............#..................#........#.........
.......................#.......#..........................................................#...............................#.....#.
...........................................................................#....#....#............................#...............
....................#............#................................................................................................
.....#.........................................#...................#.....#...#.......#..............#............................#
...#.......................................#.........#............#...................#......................#....#............##.
...##.#...........................................#...#................#..........................................................
.......#..##............#..#............#......................................#...............#...........#.........#......#..#..
...............................................................................#.........##........##.............#...............
......#...............................#.........#............#..............................#.........................#....#......
#...........................#....#..#....................................................#..................#.....................
......#.##.......#...........................#...#........#.................................................................#.....
..........#.................................................#..........................................#....#.#.........#.#.#.....
...#...#.....#......#.......#..#.#.........#...............................................................#..........##.........#
..#...#...#..........................................#............................#..........#..........#.........................
#....#............#......#.............#.#.......##...............#................#.............................#................
...............................#...............................................................#..............#.........#.........
....#..............#..#............................................................#.......#................#...................#.
....#...........................#.............................#.............#....#.........#....#...................#.......#.#...
.......#.......................................#....#........#..............#........#....................#.......................
........#...........................#................................#............................................................
...........#....#........#......................................#...........#.................................#..........#........
........#..........................................................................................#...........................#..
#........................................#.................................................................##...#.....#...........
............#..............#...........#............#................#..#.......................#.#.....#.............##..........
..........#..................#..................................................................................................#.
.....................................#..............##..................................#.............#........#..................
..............................#..................#...............#......#..##....................#................................
..#............#....................................#.......................................................#...#.................
..................###..........................#.......#.................................#........................................
.....#.#..........................................................#...........##...#.....#.................................#......
.............................................#.............................#......................#.............#.......#.....#...
...#......................#............#..................................#........................#....................#.......#.
....##..........#..........#...#.............#............#....#......#....................#...........#..#..........#............
..#......................#............#..#..#.......................#.........#......#...............#............#..#............
..#.............#.#.............................#......#......#.........................#......#.#...............#...............#
...#...........#...............#.....................................#.................#....#....#...................#.#...#......
.......#........#....................#.............................................#..............................................
........#............................#....#....#........#...................#.#...............#...#.....................#.........
.##........#.................#...........#...............................##.#.....................................................
.###...........................#........#..#................................................#...........................#........."""

import numpy as np
import pandas as pd
import time 

start_time = time.time()
# Split the string into rows
rows = puzzle_input.split('\n')
# Make each row a list
char_lists = [list(row) for row in rows]

# Convert to a 2D NumPy array
bigmap = pd.DataFrame(char_lists)

location_tracker = list()

starting_position = np.where(bigmap=='^')
starting_row,starting_col = int(starting_position[0][0]), int(starting_position[1][0])

location_tracker.append((starting_row,starting_col)) #Adding the starting position to the location tracker {(8, 2), (5, 4), (1, 3), (6, 4)}

rows,col = np.where(bigmap=='#')

boundary_positions = set(zip(rows,col)) #Boundary positions is a list of all the obstacles


def moving_upwards(current_row,current_col):
    while current_row > 0:
        current_row-=1
    
        if (current_row, current_col) in boundary_positions:
            return (current_row+1,current_col)
        
        if len(location_tracker) > 25000:
            return "Loop Detected"
        
        location_tracker.append((current_row,current_col))
        
    # If we reach here, we've gone out of bounds
    return "Out Of Bounds"


def moving_rightwards(current_row,current_col):
    while current_col < bigmap.shape[1] - 1:
        current_col+=1

        if (current_row,current_col) in boundary_positions:
            return(current_row,current_col-1)
        
        if len(location_tracker) > 25000:
            return "Loop Detected"

        location_tracker.append((current_row,current_col))

    return "Out Of Bounds"



def moving_downwards(current_row,current_col):
    while current_row < bigmap.shape[0] - 1:
        current_row+=1

        if (current_row, current_col) in boundary_positions:
            return(current_row-1,current_col)
        
        if len(location_tracker) > 25000:
            return "Loop Detected"
        
        location_tracker.append((current_row,current_col))
    
    return "Out Of Bounds"



def moving_leftwards(current_row,current_col):
    while current_col > 0:
        current_col -=1

        if (current_row,current_col) in boundary_positions:
            return(current_row,current_col+1)
        
        if len(location_tracker) > 25000:
            return "Loop Detected"
        
        location_tracker.append((current_row,current_col))
        
    return "Out Of Bounds"


def movement_checker(starting_row,starting_col):
    location_tracker.clear()
    
    while True:
        next_position = moving_upwards(starting_row,starting_col)
        if next_position == "Out Of Bounds":    
            return "Out Of Bounds"
        
        if next_position =="Loop Detected":
            return "Loop Detected"

        else:
            starting_row,starting_col = next_position
        
        next_position = moving_rightwards(starting_row,starting_col)
        if next_position == "Out Of Bounds":    
            return "Out Of Bounds"
        if next_position =="Loop Detected":
            return "Loop Detected"
        else:
            starting_row,starting_col = next_position

        next_position = moving_downwards(starting_row,starting_col)
        if next_position == "Out Of Bounds":    
            return "Out Of Bounds"
        
        if next_position =="Loop Detected":
            return "Loop Detected"
        
        else:
            starting_row,starting_col = next_position
        
        next_position = moving_leftwards(starting_row,starting_col)
        if next_position == "Out Of Bounds":    
            return "Out Of Bounds"
        
        if next_position =="Loop Detected":
            return "Loop Detected"
        
        else:
            starting_row,starting_col = next_position

# Check for all positions where a boundary can be placed to cause a loop
loop_positions = 0

for row in range(bigmap.shape[0]):  # Iterate through all rows
    for col in range(bigmap.shape[1]):  # Iterate through all columns
        if bigmap.iloc[row, col] == '.':  # Only check empty spaces
            # Add the boundary and check for a loop
            boundary_positions.add((row, col))

            if movement_checker(starting_row, starting_col) == 'Loop Detected':
                loop_positions+=1

            # Remove the boundary after the check
            boundary_positions.remove((row, col))

print("Number of positions where a boundary can cause a loop:", loop_positions)

end_time = time.time()

print("Time Taken:", end_time - start_time)


#1753
#Time Taken: 64 seconds
